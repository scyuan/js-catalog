(function(t,e){if(typeof define==="function"&&define.amd){define("Catalog",["module"],e)}else if(typeof exports!=="undefined"){e(module)}else{var n={exports:{}};e(n);t.Catalog=n.exports}})(this,function(t){"use strict";var c=function(){function n(t,e){var n=[];var o=true;var a=false;var i=undefined;try{for(var s=t[Symbol.iterator](),l;!(o=(l=s.next()).done);o=true){n.push(l.value);if(e&&n.length===e)break}}catch(t){a=true;i=t}finally{try{if(!o&&s["return"])s["return"]()}finally{if(a)throw i}}return n}return function(t,e){if(Array.isArray(t)){return t}else if(Symbol.iterator in Object(t)){return n(t,e)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();function n(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var o=function(){function o(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||false;o.configurable=true;if("value"in o)o.writable=true;Object.defineProperty(t,o.key,o)}}return function(t,e,n){if(e)o(t.prototype,e);if(n)o(t,n);return t}}();var e=function(){function e(t){n(this,e);this.options={selector:"h1,h2,h3,h4,h5,h6",contentEl:"",catalogEl:"",offsetTop:0};this.tags=null;this.content=null;this.catalog=null;this.prev=null;this.hasScroll=false;this._init(t);return this}o(e,[{key:"_init",value:function t(e){this.options=Object.assign({},this.options,e);if(!this.options.catalogEl||!this.options.catalogEl){console.warn("catalogEl Or contentEl is undefined");return}this.content=document.querySelector(this.options.contentEl);this.catalog=document.querySelector(this.options.catalogEl);if(!this.content){console.warn("the dom of "+this.options.contentEl+" is not found");return}if(!this.catalog){console.warn("the dom of "+this.options.catalogEl+" is not found");return}this._generateTree();this._bind();this._activeIndex();this._finish()}},{key:"_finish",value:function t(){var e=this;if(window&&window.location.hash){var n=window.location.hash;var o=n.split("-"),a=c(o,2),i=a[0],s=a[1];if(isNaN(s))return;s=parseInt(s);var l=this.catalog.getElementsByTagName("li")[s];if(!l)return;var r=document.getElementById(""+n.replace("#","")).getBoundingClientRect();setTimeout(function(){if(e.hasScroll){e.content.scrollBy(0,r.y-e.options.offsetTop)}else{window.scrollBy(0,r.y-e.options.offsetTop)}},0)}}},{key:"_generateTree",value:function t(){this.tags=this.content.querySelectorAll(this.options.selector);if(this.tags.length<=0){this.catalog.innerHTML='<div class="js-catalog_container"></div>';return}this.tags=this._findParants();var e=this._getTree();var n=this._getHtml(e);this.catalog.innerHTML='<div class="js-catalog_container"><div id="js-catalog_wrapper"><div class="js-catalog_hover"></div>'+n+"</div></div>"}},{key:"_bind",value:function t(){var e=parseFloat(this._getStyle(this.content,"height").replace("px",""));e=Math.round(e);var n=this.content.scrollHeight;if(n>e){this.hasScroll=true;this.content.addEventListener("scroll",this._activeIndex.bind(this))}else{window.addEventListener("scroll",this._activeIndex.bind(this))}this.catalog.addEventListener("click",this._handleClick.bind(this))}},{key:"_handleClick",value:function t(e){if(e.target.tagName=="UL")return;var n=e.target.getAttribute("data-catalog");var o=document.getElementById(n).getBoundingClientRect();document.getElementsByClassName("js-catalog_hover")[0].style.top=e.target.offsetTop+"px";if(this.hasScroll){this.content.scrollBy(0,o.y-this.options.offsetTop)}else{window.scrollBy(0,o.y-this.options.offsetTop)}if(window&&window.location)location.hash=n}},{key:"_getStyle",value:function t(e,n){if(window.getComputedStyle){return getComputedStyle(e,null)[n]}else{return e.currentStyle[n]}}},{key:"_findParants",value:function t(){var e=[];for(var n=0;n<this.tags.length;n++){this.tags[n].id="head-"+n;var o={title:this.tags[n].innerText||this.tags[n].textContent,tagName:this.tags[n].tagName,id:"head-"+n,parent:"",children:[]};if(n==0){e.push(o);continue}for(var a=n-1;a>=0;a--){if(this.tags[n].tagName.replace("H","")>this.tags[a].tagName.replace("H","")){o.parent=this.tags[a].id;e.push(o);break}else if(a==0){e.push(o)}}}return e}},{key:"_getTree",value:function t(){var n=[];var o={};this.tags.forEach(function(t){o[t.id]=t});this.tags.forEach(function(t){var e=o[t.parent];if(e){e.children.push(t)}else{n.push(t)}});return n}},{key:"_getHtml",value:function t(e){var n='<ul class="js-catalog_ul">';var o="</ul>";var a="";for(var i=0;i<e.length;i++){if(e[i].children.length>0){a=a+('<li class="js-catalog_li" data-catalog="'+e[i].id+'">'+e[i].title+"</li>")+this._getHtml(e[i].children)}else{a=a+('<li class="js-catalog_li" data-catalog="'+e[i].id+'">'+e[i].title+"</li>")}}return n+a+o}},{key:"_activeIndex",value:function t(){if(!document.querySelector(this.options.catalogEl)||!document.querySelector(this.options.catalogEl))return;if(this.catalog.getElementsByTagName("li").length<=0)return;var e=this.content.querySelectorAll(this.options.selector);var n=[];for(var o=0;o<e.length;o++){n.push(document.getElementById(e[o].id).getBoundingClientRect())}var a=0;for(var i=0;i<n.length;i++){if(n[i].bottom>=this.options.offsetTop){a=i;break}}var s=this.catalog.getElementsByTagName("li")[a];if(this.prev){this.prev.className=this.prev.className.replace("js-catalog_active","")}s.className=s.className.replace("js-catalog_active","")+" js-catalog_active";this.prev=s;var l=document.getElementsByClassName("js-catalog_hover")[0];l.style.top=s.offsetTop+"px";var r={top:l.getBoundingClientRect().top,bottom:l.getBoundingClientRect().bottom};var c=document.getElementsByClassName("js-catalog_container")[0];var h=c.scrollTop;var u=c.scrollHeight;var g={top:c.getBoundingClientRect().top,bottom:c.getBoundingClientRect().bottom};var f={top:document.getElementById("js-catalog_wrapper").getBoundingClientRect().top,bottom:document.getElementById("js-catalog_wrapper").getBoundingClientRect().bottom};var d=c.clientHeight;h=c.scrollTop;if(r.bottom>g.bottom){var v=f.bottom-r.bottom;if(v>d){document.getElementsByClassName("js-catalog_container")[0].scrollBy(0,d/2)}else{document.getElementsByClassName("js-catalog_container")[0].scrollBy(0,u-d-h)}}else{if(r.top<g.top){var p=r.top-f.top;if(p>d){document.getElementsByClassName("js-catalog_container")[0].scrollBy(0,-d/2)}else{document.getElementsByClassName("js-catalog_container")[0].scrollBy(0,-(u-d-h))}}}}}]);return e}();t.exports=e});
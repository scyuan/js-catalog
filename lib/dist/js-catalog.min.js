"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function a(t,e){for(var o=0;o<e.length;o++){var a=e[o];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(t,a.key,a)}}return function(t,e,o){if(e)a(t.prototype,e);if(o)a(t,o);return t}}();function _classCallCheck(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var Catalog=function(){function e(t){_classCallCheck(this,e);this.options={selector:"h1,h2,h3,h4,h5,h6",contentEl:"",catalogEl:"",offsetTop:0};this.tags=null;this.content=null;this.prev=null;this.hasScroll=false;this._init(t);return this}_createClass(e,[{key:"_init",value:function t(e){this.options=Object.assign({},this.options,e);if(!this.options.catalogEl||!this.options.catalogEl){console.warn("catalogEl Or contentEl is undefined");return}this.content=document.querySelector(this.options.contentEl);if(!this.content){console.warn("the dom of "+this.options.contentEl+" is not found");return}this.tags=this.content.querySelectorAll(this.options.selector);if(!this.tags||this.tags.length){return}this.tags=this.findParants();var o=this.getTree();var a=this.getHtml(o);document.querySelector(this.options.catalogEl).innerHTML='<div class="js-catalog_container"><div id="js-catalog_wrapper"><div class="js-catalog_hover"></div>'+a+"</div></div>";this._bind();this.activeIndex();var n=parseFloat(this._getStyle(document.querySelector(this.options.contentEl),"height").replace("px",""));n=Math.round(n);var s=document.querySelector(this.options.contentEl).scrollHeight;if(s>n){this.hasScroll=true;document.querySelector(this.options.contentEl).addEventListener("scroll",this.activeIndex.bind(this))}else{window.addEventListener("scroll",this.activeIndex.bind(this))}}},{key:"_bind",value:function t(){var a=this;document.querySelector(this.options.catalogEl).addEventListener("click",function(t){if(t.target.tagName=="UL")return;var e=t.target.getAttribute("data-catalog");var o=document.getElementById(e).getBoundingClientRect();document.getElementsByClassName("js-catalog_hover")[0].style.top=t.target.offsetTop+"px";if(a.hasScroll){document.querySelector(a.options.contentEl).scrollBy(0,o.y-a.options.offsetTop)}else{window.scrollBy(0,o.y-a.options.offsetTop)}})}},{key:"_getStyle",value:function t(e,o){if(window.getComputedStyle){return getComputedStyle(e,null)[o]}else{return e.currentStyle[o]}}},{key:"findParants",value:function t(){var e=[];for(var o=0;o<this.tags.length;o++){this.tags[o].id="head-"+o;var a={title:this.tags[o].innerText||tags[o].textContent,tagName:this.tags[o].tagName,id:"head-"+o,parent:"",children:[]};if(o==0){e.push(a);continue}for(var n=o-1;n>=0;n--){if(this.tags[o].tagName.replace("H","")>this.tags[n].tagName.replace("H","")){a.parent=this.tags[n].id;e.push(a);break}else if(n==0){e.push(a)}}}return e}},{key:"getTree",value:function t(){var o=[];var a={};this.tags.forEach(function(t){a[t.id]=t});this.tags.forEach(function(t){var e=a[t.parent];if(e){e.children.push(t)}else{o.push(t)}});return o}},{key:"getHtml",value:function t(e){var o='<ul class="js-catalog_ul">';var a="</ul>";var n="";for(var s=0;s<e.length;s++){if(e[s].children.length>0){n=n+('<li class="js-catalog_li" data-catalog="'+e[s].id+'">'+e[s].title+"</li>")+this.getHtml(e[s].children)}else{n=n+('<li class="js-catalog_li" data-catalog="'+e[s].id+'">'+e[s].title+"</li>")}}return o+n+a}},{key:"activeIndex",value:function t(){var e=document.querySelector(this.options.contentEl).querySelectorAll(this.options.selector);var o=[];for(var a=0;a<e.length;a++){o.push(document.getElementById(e[a].id).getBoundingClientRect())}var n=0;for(var s=0;s<o.length;s++){if(o[s].bottom>=this.options.offsetTop){n=s;break}}var l=document.querySelector(this.options.catalogEl).getElementsByTagName("li")[n];if(this.prev){this.prev.className=this.prev.className.replace("js-catalog_active","")}l.className=l.className.replace("js-catalog_active","")+" js-catalog_active";this.prev=l;var i=document.getElementsByClassName("js-catalog_hover")[0];i.style.top=l.offsetTop+"px";var r={top:i.getBoundingClientRect().top,bottom:i.getBoundingClientRect().bottom};var c=document.getElementsByClassName("js-catalog_container")[0];var u=c.scrollTop;var g=c.scrollHeight;var h={top:c.getBoundingClientRect().top,bottom:c.getBoundingClientRect().bottom};var d={top:document.getElementById("js-catalog_wrapper").getBoundingClientRect().top,bottom:document.getElementById("js-catalog_wrapper").getBoundingClientRect().bottom};var p=c.clientHeight;var u=c.scrollTop;if(r.bottom>h.bottom){var v=d.bottom-r.bottom;if(v>p){document.getElementsByClassName("js-catalog_container")[0].scrollBy(0,p/2)}else{document.getElementsByClassName("js-catalog_container")[0].scrollBy(0,g-p-u)}}else{if(r.top<h.top){var v=r.top-d.top;if(v>p){document.getElementsByClassName("js-catalog_container")[0].scrollBy(0,-p/2)}else{document.getElementsByClassName("js-catalog_container")[0].scrollBy(0,-(g-p-u))}}}}}]);return e}();exports.default=Catalog;
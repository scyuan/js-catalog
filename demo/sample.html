<!DOCTYPE html>
<html>

<head>
  <title>catalog</title>
  <style>
    ul.catalog-ul,li.catalog-li{
			padding: 0;
			margin: 0;
			list-style: none;
			cursor: pointer;
		}
		ul.catalog-ul{
			padding-left: 10px;
		}
		#catalog{
			position: fixed;
			top: 0;
			right: 0;
		}
		#body{
			padding-right: 100px;
		}
		button{
			position: fixed;
			top: 0;
			left: 100px;
		}
li.catalog-li{
	height: 25px;
	line-height: 25px;
	transition: all 0.3s;
}
.wrapper{
	position: relative;
}
.hover{
	width: 100%;
	height: 25px;
	background: #ccc;
	position: absolute;
	left: 0;
	top: 0;
	z-index: -1;
	transition: all 0.3s;
}
.active{
	color: #fff;
}
	</style>
</head>

<body>
  <div id="body">
    <h1>标题一</h1>
    <p>最好表示已经没有上升空间，永远只在一个固定的模式上循环渐进。更好代表着更高层次的境界，举个例子，有人问“你觉得我和某某谁好看?”你说“当然是你最好看了”。当被提到的当事人不在场倒还好，要是在场，这样招人不爽的话语肯定会得罪更大批的旁人。就好比一个没经过深思熟虑就乱开口说话得罪的年轻人，让人心疼又让人无奈。但如果换做“你更好看”，意思完全不一样。因为参与的人事物只有被提到的拿来作参考，没有进一步侵犯到别人边界的意思。更好——代表有台阶下，更有无限上升空间的含义，所以傻气的我喜欢更好。</p>
    <p>最好表示已经没有上升空间，永远只在一个固定的模式上循环渐进。更好代表着更高层次的境界，举个例子，有人问“你觉得我和某某谁好看?”你说“当然是你最好看了”。当被提到的当事人不在场倒还好，要是在场，这样招人不爽的话语肯定会得罪更大批的旁人。就好比一个没经过深思熟虑就乱开口说话得罪的年轻人，让人心疼又让人无奈。但如果换做“你更好看”，意思完全不一样。因为参与的人事物只有被提到的拿来作参考，没有进一步侵犯到别人边界的意思。更好——代表有台阶下，更有无限上升空间的含义，所以傻气的我喜欢更好。</p>

    <h2>标题二</h2>
    <p>最好表示已经没有上升空间，永远只在一个固定的模式上循环渐进。更好代表着更高层次的境界，举个例子，有人问“你觉得我和某某谁好看?”你说“当然是你最好看了”。当被提到的当事人不在场倒还好，要是在场，这样招人不爽的话语肯定会得罪更大批的旁人。就好比一个没经过深思熟虑就乱开口说话得罪的年轻人，让人心疼又让人无奈。但如果换做“你更好看”，意思完全不一样。因为参与的人事物只有被提到的拿来作参考，没有进一步侵犯到别人边界的意思。更好——代表有台阶下，更有无限上升空间的含义，所以傻气的我喜欢更好。</p>
    <p>最好表示已经没有上升空间，永远只在一个固定的模式上循环渐进。更好代表着更高层次的境界，举个例子，有人问“你觉得我和某某谁好看?”你说“当然是你最好看了”。当被提到的当事人不在场倒还好，要是在场，这样招人不爽的话语肯定会得罪更大批的旁人。就好比一个没经过深思熟虑就乱开口说话得罪的年轻人，让人心疼又让人无奈。但如果换做“你更好看”，意思完全不一样。因为参与的人事物只有被提到的拿来作参考，没有进一步侵犯到别人边界的意思。更好——代表有台阶下，更有无限上升空间的含义，所以傻气的我喜欢更好。</p>
    <h1>标题三</h1>
    <p>最好表示已经没有上升空间，永远只在一个固定的模式上循环渐进。更好代表着更高层次的境界，举个例子，有人问“你觉得我和某某谁好看?”你说“当然是你最好看了”。当被提到的当事人不在场倒还好，要是在场，这样招人不爽的话语肯定会得罪更大批的旁人。就好比一个没经过深思熟虑就乱开口说话得罪的年轻人，让人心疼又让人无奈。但如果换做“你更好看”，意思完全不一样。因为参与的人事物只有被提到的拿来作参考，没有进一步侵犯到别人边界的意思。更好——代表有台阶下，更有无限上升空间的含义，所以傻气的我喜欢更好。</p>
    <p>最好表示已经没有上升空间，永远只在一个固定的模式上循环渐进。更好代表着更高层次的境界，举个例子，有人问“你觉得我和某某谁好看?”你说“当然是你最好看了”。当被提到的当事人不在场倒还好，要是在场，这样招人不爽的话语肯定会得罪更大批的旁人。就好比一个没经过深思熟虑就乱开口说话得罪的年轻人，让人心疼又让人无奈。但如果换做“你更好看”，意思完全不一样。因为参与的人事物只有被提到的拿来作参考，没有进一步侵犯到别人边界的意思。更好——代表有台阶下，更有无限上升空间的含义，所以傻气的我喜欢更好。</p>

    <h2>标题四</h2>
    <p>最好表示已经没有上升空间，永远只在一个固定的模式上循环渐进。更好代表着更高层次的境界，举个例子，有人问“你觉得我和某某谁好看?”你说“当然是你最好看了”。当被提到的当事人不在场倒还好，要是在场，这样招人不爽的话语肯定会得罪更大批的旁人。就好比一个没经过深思熟虑就乱开口说话得罪的年轻人，让人心疼又让人无奈。但如果换做“你更好看”，意思完全不一样。因为参与的人事物只有被提到的拿来作参考，没有进一步侵犯到别人边界的意思。更好——代表有台阶下，更有无限上升空间的含义，所以傻气的我喜欢更好。</p>
    <p>最好表示已经没有上升空间，永远只在一个固定的模式上循环渐进。更好代表着更高层次的境界，举个例子，有人问“你觉得我和某某谁好看?”你说“当然是你最好看了”。当被提到的当事人不在场倒还好，要是在场，这样招人不爽的话语肯定会得罪更大批的旁人。就好比一个没经过深思熟虑就乱开口说话得罪的年轻人，让人心疼又让人无奈。但如果换做“你更好看”，意思完全不一样。因为参与的人事物只有被提到的拿来作参考，没有进一步侵犯到别人边界的意思。更好——代表有台阶下，更有无限上升空间的含义，所以傻气的我喜欢更好。</p>

    <h3>标题五</h3>
    <p>最好表示已经没有上升空间，永远只在一个固定的模式上循环渐进。更好代表着更高层次的境界，举个例子，有人问“你觉得我和某某谁好看?”你说“当然是你最好看了”。当被提到的当事人不在场倒还好，要是在场，这样招人不爽的话语肯定会得罪更大批的旁人。就好比一个没经过深思熟虑就乱开口说话得罪的年轻人，让人心疼又让人无奈。但如果换做“你更好看”，意思完全不一样。因为参与的人事物只有被提到的拿来作参考，没有进一步侵犯到别人边界的意思。更好——代表有台阶下，更有无限上升空间的含义，所以傻气的我喜欢更好。</p>

    <h4>标题六</h4>
    <p>最好表示已经没有上升空间，永远只在一个固定的模式上循环渐进。更好代表着更高层次的境界，举个例子，有人问“你觉得我和某某谁好看?”你说“当然是你最好看了”。当被提到的当事人不在场倒还好，要是在场，这样招人不爽的话语肯定会得罪更大批的旁人。就好比一个没经过深思熟虑就乱开口说话得罪的年轻人，让人心疼又让人无奈。但如果换做“你更好看”，意思完全不一样。因为参与的人事物只有被提到的拿来作参考，没有进一步侵犯到别人边界的意思。更好——代表有台阶下，更有无限上升空间的含义，所以傻气的我喜欢更好。</p>

    <h3>标题七</h3>
    <p>最好表示已经没有上升空间，永远只在一个固定的模式上循环渐进。更好代表着更高层次的境界，举个例子，有人问“你觉得我和某某谁好看?”你说“当然是你最好看了”。当被提到的当事人不在场倒还好，要是在场，这样招人不爽的话语肯定会得罪更大批的旁人。就好比一个没经过深思熟虑就乱开口说话得罪的年轻人，让人心疼又让人无奈。但如果换做“你更好看”，意思完全不一样。因为参与的人事物只有被提到的拿来作参考，没有进一步侵犯到别人边界的意思。更好——代表有台阶下，更有无限上升空间的含义，所以傻气的我喜欢更好。</p>

    <h1>标题八</h1>
    <p>最好表示已经没有上升空间，永远只在一个固定的模式上循环渐进。更好代表着更高层次的境界，举个例子，有人问“你觉得我和某某谁好看?”你说“当然是你最好看了”。当被提到的当事人不在场倒还好，要是在场，这样招人不爽的话语肯定会得罪更大批的旁人。就好比一个没经过深思熟虑就乱开口说话得罪的年轻人，让人心疼又让人无奈。但如果换做“你更好看”，意思完全不一样。因为参与的人事物只有被提到的拿来作参考，没有进一步侵犯到别人边界的意思。更好——代表有台阶下，更有无限上升空间的含义，所以傻气的我喜欢更好。</p>

  </div>
  <div id='catalog'></div>

  <button type="button" onclick="create();">生成目录</button>
</body>
<script type="text/javascript">
  var prev = null;
  var isClick = false;

  function create(opts) {
    // body...
    // 根据body内的标签生成标签树

    var default_opts = {
      content: 'body',
      catalog: 'catalog'
    }

    var content = document.getElementById('body');
    var tags = document.querySelectorAll("h1,h2,h3,h4,h5,h6");
    tags = findParants(tags);
    var tree = getTree(tags);
    var htmlTree = getHtml(tree);
    //var prev = null;

    document.getElementById('catalog').innerHTML = `<div class="wrapper"><div class="hover"></div>${htmlTree}</div>`;
    document.getElementById('catalog').addEventListener('click', function (e) {
      if (e.target.tagName == 'UL') return;
      if (prev) {
        prev.className = prev.className.replace('active', '');
      }
      e.target.className = e.target.className + ' active';
      prev = e.target;
      var datasetId = e.target.getAttribute('data-catalog');
      const bounding = document.getElementById(datasetId).getBoundingClientRect();
      document.getElementsByClassName('hover')[0].style.top = e.target.offsetTop + 'px';
      window.scrollBy({
        top: bounding.y,
        behavior: 'smooth'
      });
    })
    activeIndex(tags);
  }

  function activeIndex(tags) {
    for (var i = 0; i < tags.length - 1; i++) {
      if (document.getElementById(tags[i].id).getBoundingClientRect().top <= 0 &&
        document.getElementById(tags[i + 1].id).getBoundingClientRect().top >= 0) {
        var target = document.getElementById('catalog').getElementsByTagName('li')[i];
        if (prev) {
          prev.className = prev.className.replace('active', '');
        }
        target.className = target.className + ' active';
        prev = target;
        document.getElementsByClassName('hover')[0].style.top = target.offsetTop + 'px';
        break;
      }
    }
  }

  function getHtml(tree) {

    var prev = '<ul class="catalog-ul">'
    var next = '</ul>'
    var content = '';
    for (var i = 0; i < tree.length; i++) {
      if (tree[i].children.length > 0) {
        content = content + `<li class="catalog-li" data-catalog="${tree[i].id}">${tree[i].title}</li>` +
          getHtml(tree[i].children)
      } else {
        content = content + `<li class="catalog-li" data-catalog="${tree[i].id}">${tree[i].title}</li>`
      }
    }
    return prev + content + next;
  }

  function findParants(tags) {

    var newTags = [];

    for (var i = 0; i < tags.length; i++) {
      tags[i].id = 'head-' + i;
      var treeItem = {
        title: tags[i].innerText || tags[i].textContent,
        tagName: tags[i].tagName,
        id: 'head-' + i,
        parent: '',
        children: []
      }

      if (i == 0) {
        newTags.push(treeItem);
        continue;
      }
      for (var j = i - 1; j >= 0; j--) {
        if (tags[i].tagName.replace('H', '') > tags[j].tagName.replace('H', '')) {
          treeItem.parent = tags[j].id;
          newTags.push(treeItem);
          break;
        } else if (j == 0) {
          newTags.push(treeItem);
        }
      }
    }
    return newTags;
  }

  function getTree(tags) {
    var trees = [];
    var map = {};
    tags.forEach(function (item) {
      map[item.id] = item;
    });
    tags.forEach(function (tag) {

      var parent = map[tag.parent];

      if (parent) {
        parent.children.push(tag);
      } else {
        trees.push(tag);
      }

    });
    return trees;
  }
</script>

</html>